{"version":3,"file":"parse_util.js","sourceRoot":"","sources":["../../../../../packages/compiler/src/parse_util.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport * as chars from './chars';\nimport {CompileIdentifierMetadata, identifierModuleUrl, identifierName} from './compile_metadata';\nimport {error} from './util';\n\nexport class ParseLocation {\n  constructor(\n      public file: ParseSourceFile, public offset: number, public line: number,\n      public col: number) {}\n\n  toString(): string {\n    return this.offset != null ? `${this.file.url}@${this.line}:${this.col}` : this.file.url;\n  }\n\n  moveBy(delta: number): ParseLocation {\n    const source = this.file.content;\n    const len = source.length;\n    let offset = this.offset;\n    let line = this.line;\n    let col = this.col;\n    while (offset > 0 && delta < 0) {\n      offset--;\n      delta++;\n      const ch = source.charCodeAt(offset);\n      if (ch == chars.$LF) {\n        line--;\n        const priorLine = source.substr(0, offset - 1).lastIndexOf(String.fromCharCode(chars.$LF));\n        col = priorLine > 0 ? offset - priorLine : offset;\n      } else {\n        col--;\n      }\n    }\n    while (offset < len && delta > 0) {\n      const ch = source.charCodeAt(offset);\n      offset++;\n      delta--;\n      if (ch == chars.$LF) {\n        line++;\n        col = 0;\n      } else {\n        col++;\n      }\n    }\n    return new ParseLocation(this.file, offset, line, col);\n  }\n\n  // Return the source around the location\n  // Up to `maxChars` or `maxLines` on each side of the location\n  getContext(maxChars: number, maxLines: number): {before: string, after: string}|null {\n    const content = this.file.content;\n    let startOffset = this.offset;\n\n    if (startOffset != null) {\n      if (startOffset > content.length - 1) {\n        startOffset = content.length - 1;\n      }\n      let endOffset = startOffset;\n      let ctxChars = 0;\n      let ctxLines = 0;\n\n      while (ctxChars < maxChars && startOffset > 0) {\n        startOffset--;\n        ctxChars++;\n        if (content[startOffset] == '\\n') {\n          if (++ctxLines == maxLines) {\n            break;\n          }\n        }\n      }\n\n      ctxChars = 0;\n      ctxLines = 0;\n      while (ctxChars < maxChars && endOffset < content.length - 1) {\n        endOffset++;\n        ctxChars++;\n        if (content[endOffset] == '\\n') {\n          if (++ctxLines == maxLines) {\n            break;\n          }\n        }\n      }\n\n      return {\n        before: content.substring(startOffset, this.offset),\n        after: content.substring(this.offset, endOffset + 1),\n      };\n    }\n\n    return null;\n  }\n}\n\nexport class ParseSourceFile {\n  constructor(public content: string, public url: string) {}\n}\n\nexport class ParseSourceSpan {\n  constructor(\n      public start: ParseLocation, public end: ParseLocation, public details: string|null = null) {}\n\n  toString(): string {\n    return this.start.file.content.substring(this.start.offset, this.end.offset);\n  }\n}\n\nexport enum ParseErrorLevel {\n  WARNING,\n  ERROR,\n}\n\nexport class ParseError {\n  constructor(\n      public span: ParseSourceSpan, public msg: string,\n      public level: ParseErrorLevel = ParseErrorLevel.ERROR) {}\n\n  contextualMessage(): string {\n    const ctx = this.span.start.getContext(100, 3);\n    return ctx ? `${this.msg} (\"${ctx.before}[${ParseErrorLevel[this.level]} ->]${ctx.after}\")` :\n                 this.msg;\n  }\n\n  toString(): string {\n    const details = this.span.details ? `, ${this.span.details}` : '';\n    return `${this.contextualMessage()}: ${this.span.start}${details}`;\n  }\n}\n\nexport function typeSourceSpan(kind: string, type: CompileIdentifierMetadata): ParseSourceSpan {\n  const moduleUrl = identifierModuleUrl(type);\n  const sourceFileName = moduleUrl != null ? `in ${kind} ${identifierName(type)} in ${moduleUrl}` :\n                                             `in ${kind} ${identifierName(type)}`;\n  const sourceFile = new ParseSourceFile('', sourceFileName);\n  return new ParseSourceSpan(\n      new ParseLocation(sourceFile, -1, -1, -1), new ParseLocation(sourceFile, -1, -1, -1));\n}\n"]}